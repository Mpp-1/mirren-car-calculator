<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mirren Car Costing App</title>
<meta name="theme-color" content="#007BFF">

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* Global Styles */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(180deg, #0d1117 0%, #1b1f25 100%);
    color: #e0e0e0;
}
header {
    background: #007BFF;
    color: #fff;
    padding: 30px 20px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}
h1 { margin: 0; font-size: 2rem; }

/* Hero Section */
.hero {
    padding: 20px;
    text-align: center;
}

/* Form Cards */
form { max-width: 750px; margin: 20px auto; display: flex; flex-direction: column; gap: 15px; }
.card {
    background: #1e1e1e;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.card h3 { margin: 0 0 10px 0; color: #007BFF; }

/* Input Fields */
.form-group {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
label { flex: 1; font-weight: 500; color: #cccccc; }
input {
    flex: 1;
    padding: 8px;
    border: 1px solid #333;
    border-radius: 6px;
    margin-left: 10px;
    background: #2a2a2a;
    color: #ffffff;
    transition: all 0.2s;
}
input:focus { box-shadow: 0 0 5px #007BFF; outline: none; }

/* Button */
button {
    padding: 12px;
    background: #007BFF;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s;
    margin-top: 10px;
}
button:hover { background: #0056b3; }

/* Results */
.result {
    max-width: 750px;
    margin: 20px auto;
    background: #1e1e1e;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    font-size: 16px;
    color: #e0e0e0;
}
.positive { color: #4CAF50; }
.negative { color: #FF5252; }
.error { color: #FF5252; font-weight: bold; margin-top: 10px; }

/* Chart */
#costChart { margin-top: 20px; border-radius: 12px; background: #1e1e1e; padding: 10px; }

/* Footer */
footer {
    text-align: center;
    padding: 15px 20px;
    color: #999;
    background: #0d1117;
    font-size: 0.9rem;
    box-shadow: 0 -4px 10px rgba(0,0,0,0.5);
}

/* Responsive */
@media(max-width:600px){
    .form-group { flex-direction: column; align-items: flex-start; }
    input { margin-left:0;width:100%; }
}
</style>
</head>
<body>

<header>
    <h1>Mirren Car Costing App</h1>
</header>

<div class="hero">
    <!-- Optional hero content -->
</div>

<form id="costForm">
  <div class="card">
    <h3>Finance Inputs</h3>
    <div class="form-group"><label>Deposit (£):</label><input type="number" id="deposit" required></div>
    <div class="form-group"><label>Monthly Payment (£):</label><input type="number" id="monthlyPayment" required></div>
    <div class="form-group"><label>Number of Payments:</label><input type="number" id="numPayments" required></div>
    <div class="form-group"><label>Balloon Payment (£):</label><input type="number" id="balloonPayment" required></div>
  </div>

  <div class="card">
    <h3>Running Costs</h3>
    <div class="form-group"><label>Annual Mileage:</label><input type="number" id="annualMileage" required></div>
    <div class="form-group"><label>Annual Service (£):</label><input type="number" id="annualService" required></div>
    <div class="form-group"><label>Annual Repairs (£):</label><input type="number" id="annualRepairs" required></div>
    <div class="form-group"><label>Fuel Cost per Litre (£):</label><input type="number" step="0.01" id="fuelCost" required></div>
    <div class="form-group"><label>MPG UK:</label><input type="number" id="mpg" required></div>
    <div class="form-group"><label>Cost per Tyre (£):</label><input type="number" id="tyreCost" required></div>
    <div class="form-group"><label>Annual Road Tax (£):</label><input type="number" id="roadTax" required></div>
    <div class="form-group"><label>Annual Insurance (£):</label><input type="number" id="insurance" required></div>
  </div>

  <div class="card">
    <h3>Vehicle Residual</h3>
    <div class="form-group"><label>Residual Value (£):</label><input type="number" id="residualValue" required></div>
  </div>

  <button type="button" onclick="calculateCosts()">Calculate</button>
</form>

<div class="result" id="result"></div>
<canvas id="costChart" width="400" height="400"></canvas>

<footer>Created by Mirren</footer>

<script>
function calculateCosts() {
    const fields = ['deposit','monthlyPayment','numPayments','balloonPayment','annualMileage','annualService','annualRepairs','fuelCost','mpg','tyreCost','roadTax','insurance','residualValue'];
    const resultDiv = document.getElementById('result');
    let valid = true;
    fields.forEach(id => { const el=document.getElementById(id); if(!el.value || parseFloat(el.value)<0) valid=false; });
    if(!valid){ resultDiv.innerHTML='<div class="error">Please fill all fields with valid positive numbers.</div>'; return; }

    const deposit = parseFloat(document.getElementById('deposit').value);
    const monthlyPayment = parseFloat(document.getElementById('monthlyPayment').value);
    const numPayments = parseFloat(document.getElementById('numPayments').value);
    const balloonPayment = parseFloat(document.getElementById('balloonPayment').value);
    const annualMileage = parseFloat(document.getElementById('annualMileage').value);
    const annualService = parseFloat(document.getElementById('annualService').value);
    const annualRepairs = parseFloat(document.getElementById('annualRepairs').value);
    const fuelCost = parseFloat(document.getElementById('fuelCost').value);
    const mpg = parseFloat(document.getElementById('mpg').value);
    const tyreCost = parseFloat(document.getElementById('tyreCost').value);
    const roadTax = parseFloat(document.getElementById('roadTax').value);
    const insurance = parseFloat(document.getElementById('insurance').value);
    const residualValue = parseFloat(document.getElementById('residualValue').value);

    const years = numPayments/12;
    const totalMileage = annualMileage*years;

    const financeCost = deposit + monthlyPayment*numPayments + balloonPayment;
    const serviceCost = annualService*years;
    const repairsCost = annualRepairs*years;

    const milesPerLitre = mpg/4.54609;
    const litresUsed = totalMileage/milesPerLitre;
    const fuelTotal = litresUsed*fuelCost;

    const tyreReplacements = Math.floor(totalMileage/12000);
    const tyreTotal = tyreReplacements*tyreCost*4;

    const roadTaxTotal = roadTax*years;
    const insuranceTotal = insurance*years;

    const equity = residualValue - balloonPayment;
    const equityClass = equity >= 0 ? 'positive' : 'negative';

    const totalCost = financeCost + serviceCost + repairsCost + fuelTotal + tyreTotal + roadTaxTotal + insuranceTotal - residualValue;
    const totalCostWithEquity = totalCost - equity;
    const costPerMile = totalCost / totalMileage;
    const costPerMileWithEquity = totalCostWithEquity / totalMileage;

    // Display results
    resultDiv.innerHTML = `
        <div>Total Cost of Ownership (Residual Value): <strong>£${totalCost.toFixed(2)}</strong></div>
        <div>Cost per Mile (Residual Value): <strong>£${costPerMile.toFixed(2)}</strong></div>
        <div>Equity Position at End: <strong class="${equityClass}">£${equity.toFixed(2)}</strong></div>
        <div>Total Cost of Ownership (Factoring Equity): <strong>£${totalCostWithEquity.toFixed(2)}</strong></div>
        <div>Cost per Mile (Factoring Equity): <strong>£${costPerMileWithEquity.toFixed(2)}</strong></div>
    `;

    // Chart.js pie chart
    const ctx = document.getElementById('costChart').getContext('2d');
    if(window.costChart) window.costChart.destroy();
    window.costChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Finance','Fuel','Tyres','Service','Insurance & Tax'],
            datasets: [{
                data: [financeCost, fuelTotal, tyreTotal, serviceCost, insuranceTotal + roadTaxTotal],
                backgroundColor: ['#007BFF','#FF5733','#FFC300','#4CAF50','#9C27B0']
            }]
        },
        options: {
            plugins: { legend: { labels: { color: '#e0e0e0' } } }
        }
    });
}
</script>

</body>
</html>
